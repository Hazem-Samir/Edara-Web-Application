# version: '3'

volumes:
  Backend_node_modules:
    driver: local
  authservice_node_modules:
    driver: local
  supervisorservice_node_modules:
    driver: local
  requestmanagementservice_node_modules:
    driver: local
  supervisormanagementservice_node_modules:
    driver: local
  Frontend_node_modules:
    driver: local
  usermysqldata:
    driver: local
  warehousemysqldata:
    driver: local
  productmysqldata:
    driver: local
  requestmysqldata:
    driver: local

networks:
  mysql-phpmyadmin:
    name: mysql-phpmyadmin
    driver: bridge

services:
  # backend:
  #   build: ./Backend/
  #   container_name: backend
  #   ports:
  #     - "4000:4000"
  #   volumes:
  #     - ./Backend:/app
  #     - Backend_node_modules:/app/node_modules
  #   depends_on:
  #     - db
  #   restart: on-failure
  #   networks:
  #     - mysql-phpmyadmin
  #   environment:
  #     MYSQL_HOST: db
  #     MYSQL_USER: admin
  #     MYSQL_PASS: 'admin'
  #     MYSQL_DB: edara
  #     MYSQL_PORT: 3306
  authservice:
    build: ./AuthService/
    container_name: authservice
    ports:
      - "4000:4000"
    volumes:
      - ./AuthService:/app
      - authservice_node_modules:/app/node_modules
    depends_on:
      - userdb
    restart: on-failure
    networks:
      - mysql-phpmyadmin
    environment:
      MYSQL_HOST: userdb
      MYSQL_USER: admin
      MYSQL_PASS: admin
      MYSQL_DB: userdb
      MYSQL_PORT: 3306
  
  
  supervisorservice:
    build: ./SupervisorService/
    container_name: supervisorservice
    ports:
      - "4001:4000"
    volumes:
      - ./SupervisorService:/app
      - supervisorservice_node_modules:/app/node_modules
    depends_on:
      - userdb
    restart: on-failure
    networks:
      - mysql-phpmyadmin
    environment:
      MYSQL_HOST_SUPERVISOR: userdb
      MYSQL_HOST_WAREHOUSE: warehousedb
      MYSQL_HOST_REQUEST: requestdb
      MYSQL_HOST_PRODUCT : productdb
      MYSQL_USER: admin
      MYSQL_PASS: 'admin'
      MYSQL_DB_SUPERVISOR: userdb
      MYSQL_DB_WAREHOUSE: warehousedb
      MYSQL_DB_REQUEST: requestdb
      MYSQL_DB_PRODUCT : productdb
      MYSQL_PORT: 3306

  
  requestmanagementservice:
    build: ./RequestManagementService/
    container_name: requestmanagementservice
    ports:
      - "4002:4000"
    volumes:
      - ./RequestManagementService:/app
      - requestmanagementservice_node_modules:/app/node_modules
    depends_on:
      - userdb
    restart: on-failure
    networks:
      - mysql-phpmyadmin
    environment:
      MYSQL_HOST_SUPERVISOR: userdb
      MYSQL_HOST_WAREHOUSE: warehousedb
      MYSQL_HOST_REQUEST: requestdb
      MYSQL_HOST_PRODUCT : productdb
      MYSQL_USER: admin
      MYSQL_PASS: 'admin'
      MYSQL_DB_SUPERVISOR: userdb
      MYSQL_DB_WAREHOUSE: warehousedb
      MYSQL_DB_REQUEST: requestdb
      MYSQL_DB_PRODUCT : productdb
      MYSQL_PORT: 3306
  
 
  supervisormanagementservice:
    build: ./SupervisorManagementService/
    container_name: supervisormanagementservice
    ports:
      - "4003:4000"
    volumes:
      - ./SupervisorManagementService:/app
      - supervisormanagementservice_node_modules:/app/node_modules
    depends_on:
      - userdb
    restart: on-failure
    networks:
      - mysql-phpmyadmin
    environment:
      MYSQL_HOST_SUPERVISOR: userdb
      MYSQL_USER: admin
      MYSQL_PASS: 'admin'
      MYSQL_DB_SUPERVISOR: userdb
      MYSQL_PORT: 3306
  
  


  
  userdb:
    image: mysql
    container_name: userdb
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: userdb
      MYSQL_USER: admin
      MYSQL_PASSWORD: admin
    ports:
      - "3306:3306"
    expose:
      - 3306
    volumes:
      - usermysqldata:/var/lib/mysql
    networks:
      - mysql-phpmyadmin
  
  warehousedb:
    image: mysql
    container_name: warehousedb
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: warehousedb
      MYSQL_USER: admin
      MYSQL_PASSWORD: admin
    ports:
      - "3307:3306"
    expose:
      - 3306
    volumes:
      - warehousemysqldata:/var/lib/mysql
    networks:
      - mysql-phpmyadmin
  
  productdb:
    image: mysql
    container_name: productdb
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: productdb
      MYSQL_USER: admin
      MYSQL_PASSWORD: admin
    ports:
      - "3308:3306"
    expose:
      - 3306
    volumes:
      - productmysqldata:/var/lib/mysql
    networks:
      - mysql-phpmyadmin
  
  requestdb:
    image: mysql
    container_name: requestdb
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: requestdb
      MYSQL_USER: admin
      MYSQL_PASSWORD: admin
    ports:
      - "3309:3306"
    expose:
      - 3306
    volumes:
      - requestmysqldata:/var/lib/mysql
    networks:
      - mysql-phpmyadmin
  
  
  
  
  
  userphpmyadmin:
    image: phpmyadmin
    container_name: userphpmyadmin
    environment:
      PMA_HOST: userdb
      PMA_PORT: 3306
    ports:
      - 8081:80
    networks:
      - mysql-phpmyadmin
    depends_on:
      - userdb
    volumes:
      - /sessions
  
  
 
  warehousephpmyadmin:
    image: phpmyadmin
    container_name: warehousephpmyadmin
    environment:
      PMA_HOST: warehousedb
      PMA_PORT: 3306
    ports:
      - 8082:80
    networks:
      - mysql-phpmyadmin
    depends_on:
      - warehousedb
    volumes:
      - /sessions


  productsphpmyadmin:
    image: phpmyadmin
    container_name: productsphpmyadmin
    environment:
      PMA_HOST: productdb
      PMA_PORT: 3306
    ports:
      - 8083:80
    networks:
      - mysql-phpmyadmin
    depends_on:
      - productdb
    volumes:
      - /sessions
  
   
  
  requestphpmyadmin:
    image: phpmyadmin
    container_name: requestphpmyadmin
    environment:
      PMA_HOST: requestdb
      PMA_PORT: 3306
    ports:
      - 8084:80
    networks:
      - mysql-phpmyadmin
    depends_on:
      - warehousedb
    volumes:
      - /sessions
  
  
  
  
  
  frontend:
    build: ./Frontend/
    container_name: frontend
    depends_on:
      - authservice
      - supervisorservice
    ports:
      - "3000:3000"
    volumes:
      - ./Frontend:/app
      - Frontend_node_modules:/app/node_modules
    networks:
      - mysql-phpmyadmin
